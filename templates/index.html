<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Marz Node UI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body data-theme="neon">
<div class="page-root">

    <!-- ููุงุฑ ุจุงูุง ุตูุญู -->
    <header class="top-bar">
        <div class="top-left">
            <div class="logo-title">Marz Node UI</div>
            <div class="subtitle">
                ูุฏุฑุช ููุฏูุง ู ูุงุณุชโูุง ูุฑุฒูุดู ุจุง ูุงุจูุช Soft Delete ููุฏูุง
            </div>
            <div class="server-url">
                Server: <a href="{{ server_url }}" target="_blank">{{ server_url }}</a>
            </div>
        </div>

        <div class="top-right">
            <div class="top-notice">
                Theme (ููุท ุฏุฑ ุงู ูุฑูุฑฺฏุฑ ุฐุฎุฑู ูโุดูุฏ)
            </div>
            <div class="theme-switcher">
                <button class="theme-btn" data-theme="default">Default</button>
                <button class="theme-btn" data-theme="purple">Purple</button>
                <button class="theme-btn" data-theme="neon">Neon</button>
                <button class="theme-btn" data-theme="glass">Glass</button>
                <button class="theme-btn" data-theme="amoled">AMOLED</button>
                <button class="theme-btn" data-theme="minimal">Minimal</button>
            </div>
            <div class="soft-delete-hint">
                ๐ก๏ธ Soft Delete ููุฏูุง (ูุงุณุชโูุง ู ุงูุจุงูุฏูุง ุญุฐู ููโุดููุฏ)
            </div>
        </div>
    </header>

    <!-- ุฑุฏู ุงุตู: ูุงุณุชโูุง + ููุฏูุง -->
    <main class="main-grid">

        <!-- ูุงุณุชโูุง -->
        <section class="card hosts-card">
            <div class="card-header">
                <div class="card-title">ูุงุณุชโูุง (Hosts)</div>
                <div class="card-subtitle">
                    ูุฑุงุด / ุญุฐู ูุงุณุชโูุง ุจุฏูู ุฏุณุชโุฒุฏู ุจู ููุฏูุง ู ฺฉุงุฑุจุฑุงู
                </div>
            </div>

            {% if hosts_error %}
                <div class="error-box">{{ hosts_error }}</div>
            {% endif %}

            <div class="table-wrapper">
                <table class="table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>ุขุฏุฑุณ</th>
                        <th>ูพูุฑุช</th>
                        <th>ูุฒู</th>
                        <th>ูุฑุงุด / ุญุฐู</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for h in hosts %}
                        <tr>
                            <td>{{ h.id }}</td>
                            <td>{{ h.address }}</td>
                            <td>{{ h.port }}</td>
                            <td>
                                {% if h.weight is defined %}
                                    {{ h.weight }}
                                {% elif h.usage_ratio is defined %}
                                    {{ h.usage_ratio }}
                                {% else %}
                                    None
                                {% endif %}
                            </td>
                            <td>
                                <form method="post" action="/hosts/{{ h.id }}/update" class="inline-form">
                                    <input class="input input-small" type="text" name="address" value="{{ h.address }}">
                                    <input class="input input-small" type="number" name="port" value="{{ h.port }}">
                                    <input class="input input-small" type="number" name="weight"
                                           value="{% if h.weight is defined %}{{ h.weight }}{% elif h.usage_ratio is defined %}{{ h.usage_ratio }}{% else %}1{% endif %}">
                                    <button class="btn btn-primary btn-compact" type="submit">ุฐุฎุฑู</button>
                                </form>

                                <form method="post" action="/hosts/{{ h.id }}/delete" class="inline-form">
                                    <button class="btn btn-danger btn-compact" type="submit">ุญุฐู</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ููุฏูุง -->
        <section class="card nodes-card">
            <div class="card-header">
                <div class="card-title">ููุฏูุง (Nodes)</div>
                <div class="card-subtitle">
                    ุญุงูุช Soft Delete ููุฏูุง (ูุงุณุชโูุง ู ุงูุจุงูุฏูุง ุญุฐู ููโุดููุฏ)
                </div>
            </div>

            {% if nodes_error %}
                <div class="error-box">{{ nodes_error }}</div>
            {% endif %}

            <div class="table-wrapper">
                <table class="table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>ุขุฏุฑุณ</th>
                        <th>ูพูุฑุช</th>
                        <th>ูุงู</th>
                        <th>Soft Delete / ูุฑุงุด</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for n in nodes %}
                        <tr>
                            <td>{{ n.id }}</td>
                            <td>{{ n.address }}</td>
                            <td>{{ n.port }}</td>
                            <td>{{ n.name }}</td>
                            <td>
                                <form method="post" action="/nodes/{{ n.id }}/soft-delete" class="inline-form">
                                    <button class="btn btn-danger btn-compact" type="submit">Soft Delete</button>
                                </form>

                                <a class="btn btn-primary btn-compact"
                                   href="/?node_id={{ n.id }}">ูุฑุงุด</a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- ุงุฌุงุฏ ููุฏ ุฌุฏุฏ -->
            <div class="new-node-block">
                <div class="card-subtitle">ุงุฌุงุฏ ููุฏ ุฌุฏุฏ</div>
                <p class="hint-text">
                    ุจุนุฏ ุงุฒ ุณุงุฎุช ููุฏุ ุงุณฺฉุฑูพุช ูุฑุฒูุดู ุฑุง ุฑู ุณุฑูุฑ ููุตุฏ ูุตุจ ฺฉู ุชุง ููุฏ ุขููุงู ุดูุฏ.
                </p>
                <form method="post" action="/nodes/create" class="new-node-form">
                    <input class="input" type="text" name="name" placeholder="ูุงู ููุฏ">
                    <input class="input" type="text" name="address" placeholder="ุขุฏุฑุณ (IP ุง ุฏุงููู)">
                    <input class="input" type="number" name="port" placeholder="ูพูุฑุช">
                    <button class="btn btn-primary" type="submit">ุงุฌุงุฏ ููุฏ</button>
                </form>
            </div>
        </section>

    </main>

    <!-- ุฑุฏู ุฏูู: ุฌุฒุงุช ููุฏ + SSH / Xray -->
    <section class="bottom-grid">
        <!-- ุฌุฒุงุช ููุฏ ุงูุชุฎุงุจโุดุฏู -->
        <section class="card node-details-card">
            <div class="card-header">
                <div class="card-title">ุฌุฒุงุช ููุฏ ุงูุชุฎุงุจโุดุฏู</div>
                <div class="card-subtitle">
                    ุจุฑุง ูุดุงูุฏู ุฌุฒุงุชุ ุฑู ยซูุฑุงุดยป ฺฉ ุงุฒ ููุฏูุง ุฏุฑ ุฌุฏูู ุจุงูุง ฺฉูฺฉ ฺฉู.
                </div>
            </div>

            <div class="node-details-content">
                {% if selected_node %}
                    <pre class="node-details-pre">
ID: {{ selected_node.id }}
ูุงู: {{ selected_node.name }}
ุขุฏุฑุณ: {{ selected_node.address }}
ูพูุฑุช: {{ selected_node.port }}

{{ selected_node | tojson(indent=2) }}
                    </pre>
                {% else %}
                    <div class="hint-text">
                        ูููุฒ ููุฏ ุงูุชุฎุงุจ ูุดุฏู ุงุณุช.
                    </div>
                {% endif %}
            </div>
        </section>

        <!-- SSH / Xray / JSON panel -->
        <section class="card ssh-card">
            <div class="card-header">
                <div class="card-title">Xray ุฑู ููุฏ (SSH)</div>
                <div class="card-subtitle">
                    ุจุฏูู ูุงุฒ ุจู ูุฑูุฏ ูุณุชูู ุฑู ุณุฑูุฑุ ูุงู <code>config.json</code> ุฑุง ุงุฏุช ฺฉู ู ุจุนุฏ
                    ฺฉุงูุชูุฑ Xray ุฑุง ุจุง <code>docker compose</code> ุฑโุงุณุชุงุฑุช ฺฉู.
                    ูุณุฑูุง ุทุจู <b>ูุงู ููุฏ (ุจุฑฺุณุจ ูพูุดู)</b> ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุณุงุฎุชู ูโุดููุฏ.
                </div>
            </div>

            <form method="post" action="/ssh/save-config" class="ssh-form">
                {% if selected_node %}
                    <input type="hidden" name="node_id" value="{{ selected_node.id }}">
                {% endif %}

                <div class="ssh-grid">
                    <div class="ssh-col">
                        <label class="field-label">IP / Host</label>
                        <input class="input" type="text" name="ssh_host"
                               value="{{ ssh_info.ssh_host }}" placeholder="IP / Host">

                        <label class="field-label">SSH Port</label>
                        <input class="input" type="number" name="ssh_port"
                               value="{{ ssh_info.ssh_port }}" placeholder="22">

                        <label class="field-label">User</label>
                        <input class="input" type="text" name="ssh_user"
                               value="{{ ssh_info.ssh_user }}" placeholder="root">
                    </div>

                    <div class="ssh-col">
                        <label class="field-label">Password</label>
                        <input class="input" type="password" name="ssh_password"
                               value="{{ ssh_info.ssh_password }}" placeholder="*******">

                        <label class="field-label">ูุงู ููุฏ (ุจุฑฺุณุจ ูพูุดูุ ูุซู fr ุง TR)</label>
                        <input class="input" type="text" name="ssh_node_label"
                               value="{{ ssh_info.ssh_node_label }}" placeholder="ูุซูุงู TR">
                    </div>
                </div>

                <div class="ssh-derived-info">
                    <div>๐ ูุณุฑ ููุฏ:
                        <code>
                            {% if ssh_info.ssh_node_label %}
                                /opt/marznode/{{ ssh_info.ssh_node_label }}
                            {% else %}
                                /opt/marznode/&lt;label&gt;
                            {% endif %}
                        </code>
                    </div>
                    <div>๐งพ ูุงู ุชูุธูุงุช: <code>xray/config.json</code></div>
                    <div>๐ณ docker compose:
                        <code>docker compose -f docker-compose.yml down && docker compose -f docker-compose.yml up -d</code>
                    </div>
                </div>

                <!-- JSON panel -->
                <div class="json-panel">
                    <div class="json-panel-header">
                        <span>Xray config.json</span>
                        <span class="json-panel-hint">
                            ุงูุฌุง JSON ุฑุง ูุฑุชุจ ู ฺูุฏ ุฎุท ูโุจูุ ูโุชูุงู ูุณุชูู ุงุฏุช ฺฉู.
                        </span>
                    </div>
                    <textarea class="json-textarea" name="ssh_config_json"
                              spellcheck="false">{{ ssh_json|e }}</textarea>
                </div>

                {% if ssh_error %}
                    <div class="error-box">{{ ssh_error }}</div>
                {% endif %}

                <div class="actions-row">
                    <button class="btn btn-secondary"
                            type="submit"
                            formaction="/ssh/load-config">
                        ุฎูุงูุฏู config.json ุงุฒ ููุฏ
                    </button>

                    <button class="btn btn-danger" type="submit">
                        ุฐุฎุฑู config.json ุฑู ููุฏ ู ุงุฌุฑุง docker compose
                    </button>

                    <button class="btn btn-warning"
                            type="submit"
                            formaction="/ssh/node-off">
                        ุฎุงููุด ูููุช ููุฏ (OFF)
                    </button>

                    <button class="btn btn-success"
                            type="submit"
                            formaction="/ssh/node-on">
                        ุฑูุดู ฺฉุฑุฏู ููุฏ (ON)
                    </button>
                </div>

                <div class="small-hint">
                    ุฎุงููุด/ุฑูุดู ฺฉุฑุฏู ููุฏ ููุท ุฑู ฺฉุงูุชูุฑ Xray ููุงู VPS ุงูุฌุงู ูโุดูุฏุ
                    ูุงุณุชโูุง ู ฺฉุงุฑุจุฑุงู ุฏุฑ ูพูู ูุฑุฒูุดู ุฏุณุชโูุฎูุฑุฏู ูโูุงููุฏ ๐
                </div>
            </form>
        </section>
    </section>

    <footer class="footer">
        ๐ Marz Node UI โ Soft Delete Nodes, Keep Hosts Alive โ Built for personal use
    </footer>
</div>

<script>
    // ========== Theme handling ==========
    (function () {
        const saved = localStorage.getItem("marz_theme");
        const body = document.body;
        if (saved) {
            body.setAttribute("data-theme", saved);
        }

        const buttons = document.querySelectorAll(".theme-btn");
        buttons.forEach(btn => {
            btn.addEventListener("click", () => {
                const theme = btn.getAttribute("data-theme");
                body.setAttribute("data-theme", theme);
                localStorage.setItem("marz_theme", theme);
            });
        });
    })();
</script>

</body>
</html>
